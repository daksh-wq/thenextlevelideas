<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgencyFlow | Enterprise Credit Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .pattern-bg {
            background-color: #1e3a8a;
            background-image: radial-gradient(#3b82f6 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.1;
        }
        .chat-bubble { position: relative; max-width: 80%; padding: 10px 14px; border-radius: 12px; font-size: 0.9rem; }
        .chat-mine { background-color: #3b82f6; color: white; margin-left: auto; border-bottom-right-radius: 2px; }
        .chat-other { background-color: #f1f5f9; color: #1e293b; margin-right: auto; border-bottom-left-radius: 2px; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a' },
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800 h-screen overflow-hidden flex flex-col">

    <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2 pointer-events-none"></div>

    <!-- Modal Overlay -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/50 z-40 hidden flex items-center justify-center backdrop-blur-sm transition-opacity opacity-0">
        <div id="modal-content" class="bg-white rounded-xl shadow-2xl w-full max-w-md transform scale-95 transition-all duration-200 overflow-hidden"></div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="w-full h-full flex relative">
        <!-- Login Screen -->
        <div id="login-view" class="absolute inset-0 z-30 bg-slate-100 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-4xl rounded-2xl shadow-xl flex overflow-hidden min-h-[600px]">
                <div class="hidden md:flex w-1/2 bg-brand-900 text-white flex-col justify-between p-12 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full pattern-bg"></div>
                    <div class="z-10">
                        <div class="text-3xl font-bold tracking-tight mb-2"><i class="fa-solid fa-layer-group mr-2"></i>AGENCY<span class="text-brand-500">FLOW</span></div>
                        <p class="text-brand-100">Enterprise Marketing Operations</p>
                    </div>
                    <div class="z-10">
                        <h2 class="text-4xl font-bold mb-4 leading-tight">Scale your marketing with credit-based agility.</h2>
                        <p class="text-brand-200 text-lg">Manage requests, track usage, and streamline approvals in one unified workspace.</p>
                    </div>
                    <div class="z-10 text-sm text-brand-400">© 2025 AgencyFlow Operations.</div>
                </div>
                
                <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col justify-center">
                    <div class="mb-8 text-center md:text-left">
                        <h1 class="text-2xl font-bold text-slate-900">Welcome back</h1>
                        <p class="text-slate-500">Select your portal to continue.</p>
                    </div>
                    <div class="bg-slate-100 p-1 rounded-lg flex mb-8">
                        <button onclick="switchLoginTab('admin')" id="tab-admin" class="flex-1 py-2 rounded-md text-sm font-medium transition-all bg-white shadow-sm text-brand-700">Admin Portal</button>
                        <button onclick="switchLoginTab('client')" id="tab-client" class="flex-1 py-2 rounded-md text-sm font-medium transition-all text-slate-500 hover:text-slate-700">Client Portal</button>
                    </div>
                    <form id="login-form" onsubmit="handleLogin(event)" class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">User ID</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2.5 text-slate-400"><i class="fa-regular fa-user"></i></span>
                                <input type="text" id="login-id" value="12345" class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition" placeholder="Enter ID">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2.5 text-slate-400"><i class="fa-solid fa-lock"></i></span>
                                <input type="password" id="login-pass" value="12345" class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition" placeholder="••••••">
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-brand-600 hover:bg-brand-700 text-white font-semibold py-2.5 rounded-lg transition-all shadow-lg shadow-brand-500/30 flex justify-center items-center gap-2">
                            <span>Log In</span>
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </form>
                    <div class="mt-6 text-center text-xs text-slate-400"><p>Demo Access: ID <strong>12345</strong> / Pass <strong>12345</strong></p></div>
                </div>
            </div>
        </div>

        <!-- App Layout -->
        <div id="main-layout" class="hidden w-full h-full flex">
            <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col flex-shrink-0 transition-all duration-300" id="sidebar">
                <div class="p-6 flex items-center justify-between text-white border-b border-slate-800">
                    <div class="font-bold text-xl tracking-wider"><i class="fa-solid fa-layer-group mr-2"></i>AGENCY</div>
                </div>
                <div class="p-4">
                    <div class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">Menu</div>
                    <nav id="nav-links" class="space-y-1"></nav>
                </div>
                <div class="mt-auto p-4 border-t border-slate-800">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-full bg-brand-600 flex items-center justify-center text-white font-bold" id="user-avatar">A</div>
                        <div>
                            <div class="text-sm font-medium text-white" id="user-name-display">User</div>
                            <div class="text-xs text-slate-400" id="user-role-display">Role</div>
                        </div>
                    </div>
                    <button onclick="handleLogout()" class="w-full text-left flex items-center gap-3 px-3 py-2 rounded hover:bg-slate-800 text-slate-400 hover:text-white transition">
                        <i class="fa-solid fa-arrow-right-from-bracket"></i> Sign Out
                    </button>
                </div>
            </aside>

            <main class="flex-1 flex flex-col h-full overflow-hidden bg-slate-50">
                <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shadow-sm z-20">
                    <h2 id="page-title" class="text-xl font-semibold text-slate-800">Dashboard</h2>
                    <div class="flex items-center gap-4">
                        <button class="relative p-2 text-slate-400 hover:text-brand-600 transition">
                            <i class="fa-regular fa-bell text-lg"></i>
                            <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                        </button>
                        <div id="header-actions"></div>
                    </div>
                </header>
                <div id="content-area" class="flex-1 overflow-y-auto p-6 md:p-8 relative"></div>
            </main>
        </div>
    </div>

    <script>
        // --- DATA & STATE MANAGEMENT ---
        const SERVICES = [
            { id: 'vid_edit', name: 'Reel/TikTok Edit', cost: 3, icon: 'fa-video' },
            { id: 'ad_copy', name: 'Ad Copywriting', cost: 2, icon: 'fa-pen-nib' },
            { id: 'static_ad', name: 'Static Ad Design', cost: 4, icon: 'fa-image' },
            { id: 'thumbnail', name: 'YouTube Thumbnail', cost: 1, icon: 'fa-photo-film' },
            { id: 'strategy', name: 'Strategy Call (1h)', cost: 10, icon: 'fa-headset' }
        ];

        const PACKAGES = [
            { id: 1, name: 'Starter Pack', credits: 20, price: '$500' },
            { id: 2, name: 'Growth Pack', credits: 50, price: '$1,100' },
            { id: 3, name: 'Agency Scale', credits: 100, price: '$2,000' }
        ];

        const TEAM_MEMBERS = [
            { id: 'tm1', name: 'Sarah (Editor)' },
            { id: 'tm2', name: 'Mike (Designer)' },
            { id: 'tm3', name: 'Jessica (Manager)' }
        ];

        const db = {
            clients: [
                { id: '12345', name: 'Acme Corp', email: 'marketing@acme.com', credits: 45, status: 'Active', joined: '2023-01-15', spent: 120 },
                { id: '67890', name: 'Beta Startups', email: 'founder@beta.io', credits: 2, status: 'Suspended', joined: '2023-06-20', spent: 50 }
            ],
            requests: [
                { 
                    id: 'REQ-101', 
                    clientId: '12345', 
                    service: 'Reel/TikTok Edit', 
                    cost: 3, 
                    status: 'Completed', 
                    date: '2023-10-25', 
                    notes: 'Make it pop!',
                    assignee: 'Sarah (Editor)',
                    eta: '2023-10-26',
                    files: ['Raw_Footage_01.mp4', 'Logo.png'],
                    messages: [
                        { sender: 'Client', text: 'Uploaded the raw files. Please sync to the beat.', time: 'Oct 25, 09:00 AM' },
                        { sender: 'Sarah (Editor)', text: 'Got it! Working on the rough cut now.', time: 'Oct 25, 10:30 AM' },
                        { sender: 'Sarah (Editor)', text: 'Sent the draft. Let me know what you think.', time: 'Oct 25, 04:00 PM' }
                    ]
                },
                { 
                    id: 'REQ-102', 
                    clientId: '12345', 
                    service: 'Strategy Call (1h)', 
                    cost: 10, 
                    status: 'Approved', 
                    date: '2023-10-28', 
                    notes: 'Q4 Planning',
                    assignee: 'Jessica (Manager)',
                    eta: '2023-11-01',
                    files: ['Q3_Report.pdf'],
                    messages: []
                },
                { 
                    id: 'REQ-103', 
                    clientId: '67890', 
                    service: 'Static Ad Design', 
                    cost: 4, 
                    status: 'Pending', 
                    date: '2023-11-01', 
                    notes: 'Black Friday Promo',
                    assignee: 'Unassigned',
                    eta: 'TBD',
                    files: [],
                    messages: []
                }
            ],
            invoices: [
                { id: 'INV-2023-001', clientId: '12345', amount: '$1,100', date: '2023-10-15', status: 'Paid' },
                { id: 'INV-2023-002', clientId: '67890', amount: '$500', date: '2023-11-01', status: 'Pending' }
            ],
            logs: [
                { id: 1, date: '2023-11-01 10:00', user: 'Admin', action: 'System Login', details: 'Logged in from IP 192.168.1.1' },
                { id: 2, date: '2023-10-28 14:30', user: 'Acme Corp', action: 'Request Approved', details: 'Strategy Call deducted 10 credits' }
            ]
        };

        let currentUser = null;
        let currentRole = null;

        const getClient = (id) => db.clients.find(c => c.id === id);
        const fmtDate = (d) => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const generateId = () => 'REQ-' + Math.floor(Math.random() * 10000);
        const generateInvId = () => 'INV-' + new Date().getFullYear() + '-' + Math.floor(Math.random() * 1000);

        // --- AUTH ---
        let loginTab = 'admin';
        function switchLoginTab(tab) {
            loginTab = tab;
            document.getElementById('tab-admin').className = tab === 'admin' ? "flex-1 py-2 rounded-md text-sm font-medium transition-all bg-white shadow-sm text-brand-700" : "flex-1 py-2 rounded-md text-sm font-medium transition-all text-slate-500 hover:text-slate-700";
            document.getElementById('tab-client').className = tab === 'client' ? "flex-1 py-2 rounded-md text-sm font-medium transition-all bg-white shadow-sm text-brand-700" : "flex-1 py-2 rounded-md text-sm font-medium transition-all text-slate-500 hover:text-slate-700";
        }

        function handleLogin(e) {
            e.preventDefault();
            const id = document.getElementById('login-id').value;
            const pass = document.getElementById('login-pass').value;

            if (id === '12345' && pass === '12345') {
                const btn = e.target.querySelector('button');
                btn.innerHTML = `<i class="fa-solid fa-circle-notch fa-spin"></i> Authenticating...`;
                setTimeout(() => {
                    document.getElementById('login-view').classList.add('hidden');
                    document.getElementById('main-layout').classList.remove('hidden');
                    currentRole = loginTab;
                    if (currentRole === 'admin') {
                        currentUser = { name: 'Super Admin', id: 'ADMIN', role: 'Administrator' };
                        renderAdminNav();
                        router('admin-dashboard');
                    } else {
                        currentUser = getClient('12345'); 
                        currentUser.role = 'Client';
                        renderClientNav();
                        router('client-home');
                    }
                    updateProfileDisplay();
                    showToast(`Welcome back, ${currentUser.name}`, 'success');
                }, 800);
            } else {
                showToast('Invalid credentials. Try 12345/12345', 'error');
            }
        }

        function handleLogout() {
            currentUser = null;
            currentRole = null;
            document.getElementById('main-layout').classList.add('hidden');
            document.getElementById('login-view').classList.remove('hidden');
            document.getElementById('login-form').querySelector('button').innerHTML = `<span>Log In</span><i class="fa-solid fa-arrow-right"></i>`;
            showToast('Logged out successfully', 'info');
        }

        function updateProfileDisplay() {
            document.getElementById('user-avatar').innerText = currentUser.name.charAt(0);
            document.getElementById('user-name-display').innerText = currentUser.name;
            document.getElementById('user-role-display').innerText = currentUser.role;
        }

        function renderAdminNav() {
            document.getElementById('nav-links').innerHTML = `
                <button onclick="router('admin-dashboard')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-chart-line w-5"></i> Dashboard</button>
                <button onclick="router('admin-clients')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-users w-5"></i> Clients</button>
                <button onclick="router('admin-requests')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-inbox w-5"></i> Requests <span id="nav-badge" class="ml-auto bg-brand-600 text-xs font-bold px-2 py-0.5 rounded-full text-white hidden">0</span></button>
                <button onclick="router('admin-billing')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-file-invoice-dollar w-5"></i> Billing</button>
                <button onclick="router('admin-logs')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-list-check w-5"></i> Audit Logs</button>
            `;
            updateAdminBadges();
        }

        function renderClientNav() {
            document.getElementById('nav-links').innerHTML = `
                <button onclick="router('client-home')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-house w-5"></i> Home</button>
                <button onclick="router('client-request')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-pen-to-square w-5"></i> New Request</button>
                <button onclick="router('client-buy')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-cart-plus w-5"></i> Buy Credits</button>
                <button onclick="router('client-history')" class="w-full text-left px-3 py-2 rounded flex items-center gap-3 text-slate-400 hover:bg-slate-800 hover:text-white transition"><i class="fa-solid fa-clock-rotate-left w-5"></i> History</button>
            `;
        }

        function updateAdminBadges() {
            const pending = db.requests.filter(r => r.status === 'Pending').length;
            const badge = document.getElementById('nav-badge');
            if(badge) {
                badge.innerText = pending;
                badge.classList.toggle('hidden', pending === 0);
            }
        }

        // --- ROUTER & VIEWS ---
        function router(view, param = null) {
            const container = document.getElementById('content-area');
            const title = document.getElementById('page-title');
            const headerActions = document.getElementById('header-actions');
            headerActions.innerHTML = ''; 
            
            container.innerHTML = '<div class="flex items-center justify-center h-64"><i class="fa-solid fa-spinner fa-spin text-3xl text-brand-500"></i></div>';

            setTimeout(() => {
                if (view === 'admin-dashboard') {
                    title.innerText = 'Overview';
                    const totalClients = db.clients.length;
                    const activeCredits = db.clients.reduce((a, b) => a + b.credits, 0);
                    const pendingReq = db.requests.filter(r => r.status === 'Pending').length;
                    container.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 fade-in">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 cursor-pointer" onclick="router('admin-clients')">
                                <div class="text-slate-500 text-sm font-medium mb-2">Total Clients</div>
                                <div class="text-3xl font-bold text-slate-800">${totalClients}</div>
                                <div class="mt-2 text-xs text-emerald-600"><i class="fa-solid fa-arrow-up"></i> 12% vs last month</div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                <div class="text-slate-500 text-sm font-medium mb-2">Active Credits</div>
                                <div class="text-3xl font-bold text-brand-600">${activeCredits}</div>
                                <div class="mt-2 text-xs text-slate-400">Liability: $${activeCredits * 25}</div>
                            </div>
                             <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 cursor-pointer" onclick="router('admin-requests')">
                                <div class="text-slate-500 text-sm font-medium mb-2">Pending Requests</div>
                                <div class="text-3xl font-bold ${pendingReq > 0 ? 'text-amber-500' : 'text-slate-800'}">${pendingReq}</div>
                                <div class="mt-2 text-xs text-slate-400">Requires attention</div>
                            </div>
                             <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                <div class="text-slate-500 text-sm font-medium mb-2">Revenue (Mo)</div>
                                <div class="text-3xl font-bold text-slate-800">$12.4k</div>
                                <div class="mt-2 text-xs text-emerald-600"><i class="fa-solid fa-arrow-up"></i> On track</div>
                            </div>
                        </div>
                    `;
                } else if (view === 'admin-clients') {
                    title.innerText = 'Client Management';
                    container.innerHTML = `
                        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden fade-in">
                            <div class="p-4 border-b border-slate-100 flex gap-4">
                                <div class="relative flex-1">
                                    <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400"></i>
                                    <input type="text" id="client-search" onkeyup="filterClients()" placeholder="Search clients..." class="w-full pl-10 pr-4 py-2 bg-slate-50 border-none rounded-lg focus:ring-2 focus:ring-brand-500 outline-none">
                                </div>
                                <button onclick="openAddClientModal()" class="bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg transition"><i class="fa-solid fa-plus mr-2"></i>Add Client</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead class="bg-slate-50 text-slate-500 text-xs uppercase font-semibold">
                                        <tr><th class="px-6 py-4">Client Name</th><th class="px-6 py-4">Status</th><th class="px-6 py-4">Credits</th><th class="px-6 py-4">Actions</th></tr>
                                    </thead>
                                    <tbody id="client-table-body" class="divide-y divide-slate-100 text-sm">
                                        ${db.clients.map(client => `
                                            <tr class="hover:bg-slate-50">
                                                <td class="px-6 py-4"><div class="font-medium">${client.name}</div><div class="text-xs text-slate-500">${client.email}</div></td>
                                                <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-medium ${client.status === 'Active' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}">${client.status}</span></td>
                                                <td class="px-6 py-4 font-mono font-bold text-brand-600">${client.credits} CR</td>
                                                <td class="px-6 py-4 flex gap-2">
                                                    <button onclick="openAddCreditModal('${client.id}')" class="text-brand-600 border border-brand-200 px-2 py-1 rounded hover:bg-brand-50 text-xs"><i class="fa-solid fa-coins mr-1"></i> Adjust</button>
                                                    <button onclick="toggleClientStatus('${client.id}')" class="text-slate-500 border border-slate-200 px-2 py-1 rounded hover:bg-slate-100 text-xs"><i class="fa-solid ${client.status === 'Active' ? 'fa-ban' : 'fa-check'}"></i></button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                } else if (view === 'admin-requests') {
                    title.innerText = 'Work Queue';
                    container.innerHTML = `
                        <div class="space-y-4 fade-in">
                            ${db.requests.map(req => {
                                const client = getClient(req.clientId);
                                let statusColor = req.status === 'Approved' ? 'bg-emerald-100 text-emerald-700' : req.status === 'Pending' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700';
                                return `
                                <div onclick="router('request-detail', '${req.id}')" class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex flex-col md:flex-row items-center gap-4 cursor-pointer hover:border-brand-300 transition group">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-1">
                                            <span class="px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide ${statusColor}">${req.status}</span>
                                            <span class="text-xs text-slate-400">${req.date}</span>
                                            <span class="text-xs font-mono text-slate-300">#${req.id}</span>
                                        </div>
                                        <div class="font-bold text-lg text-slate-800 group-hover:text-brand-600 transition">${req.service}</div>
                                        <div class="text-sm text-slate-500">Client: <span class="font-medium text-slate-700">${client.name}</span> &bull; Assignee: <span class="text-slate-700">${req.assignee || 'Unassigned'}</span></div>
                                    </div>
                                    <div class="text-slate-400"><i class="fa-solid fa-chevron-right"></i></div>
                                </div>
                            `}).join('')}
                        </div>
                    `;
                } else if (view === 'request-detail') {
                    const req = db.requests.find(r => r.id === param);
                    const client = getClient(req.clientId);
                    title.innerText = `Request ${req.id}`;
                    headerActions.innerHTML = `<button onclick="router('${currentRole === 'admin' ? 'admin-requests' : 'client-home'}')" class="text-slate-500 hover:text-slate-800 text-sm"><i class="fa-solid fa-arrow-left mr-1"></i> Back</button>`;
                    
                    container.innerHTML = `
                        <div class="flex flex-col lg:flex-row gap-6 h-[calc(100vh-140px)] fade-in">
                            <!-- Left: Details -->
                            <div class="w-full lg:w-1/3 bg-white rounded-xl shadow-sm border border-slate-100 p-6 overflow-y-auto">
                                <div class="mb-6">
                                    <span class="px-2 py-1 text-xs font-bold rounded ${req.status === 'Approved' ? 'bg-emerald-100 text-emerald-700' : req.status === 'Pending' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'}">${req.status}</span>
                                    <h2 class="text-xl font-bold mt-2">${req.service}</h2>
                                    <p class="text-sm text-slate-500">Client: ${client.name}</p>
                                </div>
                                
                                <div class="space-y-6">
                                    <div>
                                        <div class="text-xs uppercase text-slate-400 font-bold mb-1">Instructions</div>
                                        <div class="text-sm text-slate-700 bg-slate-50 p-3 rounded border border-slate-100">${req.notes || 'No notes provided.'}</div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <div class="text-xs uppercase text-slate-400 font-bold mb-1">Cost</div>
                                            <div class="font-mono font-bold text-brand-600">${req.cost} Credits</div>
                                        </div>
                                        <div>
                                            <div class="text-xs uppercase text-slate-400 font-bold mb-1">ETA</div>
                                            <div class="text-sm font-medium text-slate-800">${req.eta}</div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="text-xs uppercase text-slate-400 font-bold mb-2 flex justify-between">
                                            <span>Attachments / Deliverables</span>
                                            <button onclick="fakeUpload('${req.id}')" class="text-brand-600 text-xs hover:underline"><i class="fa-solid fa-plus"></i> Add</button>
                                        </div>
                                        <div class="space-y-2" id="file-list-${req.id}">
                                            ${req.files.length ? req.files.map(f => `
                                                <div class="flex items-center gap-2 text-sm text-slate-600 bg-slate-50 p-2 rounded border border-slate-100">
                                                    <i class="fa-solid fa-file text-slate-400"></i> ${f}
                                                    <i class="fa-solid fa-download ml-auto text-slate-400 cursor-pointer hover:text-brand-600"></i>
                                                </div>
                                            `).join('') : '<div class="text-xs text-slate-400 italic">No files yet.</div>'}
                                        </div>
                                    </div>

                                    ${currentRole === 'admin' ? `
                                        <div class="pt-4 border-t border-slate-100">
                                            <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Admin Actions</label>
                                            <div class="flex flex-col gap-2">
                                                <select onchange="updateAssignee('${req.id}', this.value)" class="w-full text-sm border border-slate-200 rounded p-2">
                                                    <option value="">Select Assignee...</option>
                                                    ${TEAM_MEMBERS.map(t => `<option value="${t.name}" ${req.assignee === t.name ? 'selected' : ''}>${t.name}</option>`).join('')}
                                                </select>
                                                ${req.status === 'Pending' ? `
                                                    <div class="flex gap-2 mt-2">
                                                        <button onclick="processRequest('${req.id}', 'approve')" class="flex-1 bg-emerald-600 text-white text-xs py-2 rounded hover:bg-emerald-700">Approve</button>
                                                        <button onclick="processRequest('${req.id}', 'reject')" class="flex-1 bg-white border border-red-200 text-red-600 text-xs py-2 rounded hover:bg-red-50">Reject</button>
                                                    </div>
                                                ` : ''}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>

                            <!-- Right: Collaboration/Chat -->
                            <div class="w-full lg:w-2/3 bg-white rounded-xl shadow-sm border border-slate-100 flex flex-col overflow-hidden">
                                <div class="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-700"><i class="fa-regular fa-comments mr-2"></i>Activity & Comments</h3>
                                    <span class="text-xs text-slate-400">visible to client & team</span>
                                </div>
                                <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chat-box-${req.id}">
                                    ${req.messages.length ? req.messages.map(msg => `
                                        <div class="chat-bubble ${msg.sender === currentUser.name || (currentUser.role === 'Administrator' && msg.sender.includes('(')) ? 'chat-mine' : 'chat-other'}">
                                            <div class="text-xs opacity-75 mb-1 flex justify-between gap-4"><span>${msg.sender}</span> <span>${msg.time}</span></div>
                                            ${msg.text}
                                        </div>
                                    `).join('') : '<div class="text-center text-slate-300 mt-10">No messages yet. Start the conversation.</div>'}
                                </div>
                                <div class="p-4 border-t border-slate-100 bg-white">
                                    <form onsubmit="sendChat(event, '${req.id}')" class="flex gap-2">
                                        <input type="text" id="chat-input-${req.id}" class="flex-1 border border-slate-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-brand-500 outline-none" placeholder="Type a message..." autocomplete="off">
                                        <button type="submit" class="bg-brand-600 text-white px-4 py-2 rounded-lg hover:bg-brand-700"><i class="fa-solid fa-paper-plane"></i></button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    `;
                    // Scroll chat to bottom
                    setTimeout(() => {
                        const chatBox = document.getElementById(`chat-box-${req.id}`);
                        if(chatBox) chatBox.scrollTop = chatBox.scrollHeight;
                    }, 100);

                } else if (view === 'client-home') {
                    title.innerText = 'My Dashboard';
                    headerActions.innerHTML = `<button onclick="router('client-request')" class="bg-brand-600 hover:bg-brand-700 text-white text-sm font-medium px-4 py-2 rounded-lg transition shadow-brand-200 shadow-lg">New Request</button>`;
                    container.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 fade-in">
                            <div class="col-span-2 bg-gradient-to-br from-brand-600 to-brand-800 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden">
                                <div class="relative z-10">
                                    <div class="text-brand-200 text-sm font-medium uppercase tracking-wide mb-1">Available Balance</div>
                                    <div class="text-5xl font-bold mb-6">${currentUser.credits} <span class="text-2xl font-normal text-brand-300">Credits</span></div>
                                    <div class="flex gap-3">
                                        <button onclick="router('client-buy')" class="bg-white text-brand-700 px-4 py-2 rounded-lg text-sm font-bold hover:bg-brand-50 transition">Top Up</button>
                                        <button onclick="router('client-history')" class="bg-brand-700 text-white border border-brand-500 px-4 py-2 rounded-lg text-sm font-medium hover:bg-brand-600 transition">View Usage</button>
                                    </div>
                                </div>
                                <div class="absolute right-0 bottom-0 opacity-10 transform translate-x-8 translate-y-8"><i class="fa-solid fa-coins text-9xl"></i></div>
                            </div>
                            <div class="bg-white rounded-2xl p-6 border border-slate-100 shadow-sm">
                                <h3 class="font-semibold text-slate-800 mb-4">Quick Stats</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center"><span class="text-slate-500 text-sm">Pending Requests</span><span class="font-bold text-amber-500">${db.requests.filter(r => r.clientId === currentUser.id && r.status === 'Pending').length}</span></div>
                                    <div class="flex justify-between items-center"><span class="text-slate-500 text-sm">Total Spent</span><span class="font-bold text-slate-800">${currentUser.spent} Cr</span></div>
                                    <div class="pt-4 border-t border-slate-50"><a href="#" class="text-brand-600 text-sm hover:underline">Download Monthly Report <i class="fa-solid fa-download ml-1"></i></a></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 fade-in">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">Active Requests</h3>
                            <div class="space-y-3">
                                ${db.requests.filter(r => r.clientId === currentUser.id).map(r => `
                                    <div onclick="router('request-detail', '${r.id}')" class="bg-white p-4 rounded-xl border border-slate-100 flex justify-between items-center cursor-pointer hover:border-brand-300">
                                        <div>
                                            <div class="font-bold text-slate-800">${r.service}</div>
                                            <div class="text-xs text-slate-500">${r.date} &bull; ${r.id}</div>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <span class="px-2 py-1 text-xs font-bold rounded ${r.status === 'Approved' ? 'bg-emerald-100 text-emerald-700' : r.status === 'Pending' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'}">${r.status}</span>
                                            <i class="fa-solid fa-chevron-right text-slate-300"></i>
                                        </div>
                                    </div>
                                `).join('')}
                                ${db.requests.filter(r => r.clientId === currentUser.id).length === 0 ? '<div class="text-center text-slate-400">No active requests.</div>' : ''}
                            </div>
                        </div>
                    `;
                } else if (view === 'client-request') {
                    title.innerText = 'Request New Work';
                    container.innerHTML = `
                        <div class="max-w-3xl mx-auto fade-in">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                <div class="p-6 md:p-8">
                                    <h2 class="text-lg font-semibold text-slate-800 mb-6">Select Service</h2>
                                    <div class="space-y-6">
                                        <div>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                ${SERVICES.map(s => `
                                                    <div onclick="selectService('${s.id}', ${s.cost}, '${s.name}')" id="srv-${s.id}" class="service-card cursor-pointer border-2 border-slate-100 rounded-lg p-4 hover:border-brand-400 transition flex items-center justify-between group">
                                                        <div class="flex items-center gap-3"><div class="w-8 h-8 rounded bg-blue-50 text-blue-600 flex items-center justify-center"><i class="fa-solid ${s.icon}"></i></div><div class="font-medium text-slate-700">${s.name}</div></div>
                                                        <div class="text-sm font-bold text-slate-400 group-hover:text-brand-600">${s.cost} Cr</div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-2">Instructions</label>
                                            <textarea id="req-notes" rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none" placeholder="Describe what you need..."></textarea>
                                        </div>
                                        <div class="bg-slate-50 p-4 rounded-lg flex items-center justify-between border border-slate-200">
                                            <div><div class="text-sm text-slate-500">Cost</div><div class="text-xl font-bold text-slate-800" id="cost-display">0 Credits</div></div>
                                            <div class="text-right"><div class="text-sm text-slate-500">Remaining</div><div class="text-lg font-bold text-brand-600" id="remaining-display">${currentUser.credits} Credits</div></div>
                                        </div>
                                        <div class="flex gap-4 pt-4">
                                            <button onclick="submitRequest()" id="btn-submit-req" class="flex-1 bg-brand-600 hover:bg-brand-700 disabled:bg-slate-300 text-white py-3 rounded-lg font-semibold transition shadow-lg shadow-brand-200" disabled>Submit Request</button>
                                            <button onclick="router('client-home')" class="px-6 py-3 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50 font-medium">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (view === 'client-buy') {
                    title.innerText = 'Purchase Credits';
                    container.innerHTML = `
                        <div class="max-w-5xl mx-auto fade-in">
                            <div class="text-center mb-10"><h2 class="text-2xl font-bold text-slate-800">Simple pricing.</h2><p class="text-slate-500">Credits never expire.</p></div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                ${PACKAGES.map(pkg => `
                                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8 relative hover:border-brand-400 transition hover:shadow-xl hover:-translate-y-1">
                                        ${pkg.id === 2 ? '<div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-brand-600 text-white text-xs font-bold uppercase px-3 py-1 rounded-full">Best Value</div>' : ''}
                                        <div class="text-center">
                                            <div class="text-slate-500 font-medium mb-2">${pkg.name}</div>
                                            <div class="text-4xl font-bold text-slate-900 mb-1">${pkg.credits} <span class="text-lg font-normal text-slate-400">Credits</span></div>
                                            <div class="text-2xl text-brand-600 font-bold mb-6">${pkg.price}</div>
                                            <button onclick="buyPackage(${pkg.id})" class="w-full py-3 rounded-lg font-semibold transition ${pkg.id === 2 ? 'bg-brand-600 text-white' : 'bg-brand-50 text-brand-700'}">Select Package</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else if (view === 'client-history') {
                    title.innerText = 'History';
                    container.innerHTML = `
                        <div class="bg-white rounded-xl shadow-sm border border-slate-100 fade-in">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left"><thead class="bg-slate-50 text-xs uppercase text-slate-500"><tr><th class="px-6 py-4">Date</th><th class="px-6 py-4">Description</th><th class="px-6 py-4 text-right">Change</th></tr></thead>
                                <tbody class="divide-y divide-slate-100 text-sm">${db.logs.filter(l => l.user === currentUser.name || l.details.includes(currentUser.name)).map(log => `
                                    <tr><td class="px-6 py-4 text-slate-500">${log.date}</td><td class="px-6 py-4 font-medium text-slate-800">${log.details}</td><td class="px-6 py-4 text-right font-bold font-mono ${log.details.includes('Bought') || log.details.includes('Added') ? 'text-emerald-600' : 'text-red-500'}">${log.details.includes('Bought') || log.details.includes('Added') ? '+' : '-'}${log.details.match(/(\d+) Cr/) ? log.details.match(/(\d+) Cr/)[1] : '0'}</td></tr>
                                `).join('')}</tbody></table>
                            </div>
                        </div>
                    `;
                } else if (view === 'admin-billing') {
                    title.innerText = 'Billing';
                    container.innerHTML = `
                        <div class="grid grid-cols-1 gap-6 fade-in">
                            <div class="flex justify-between items-center"><div class="text-slate-500">Manage invoices.</div><button onclick="generateInvoice()" class="bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg shadow-sm">Generate Invoice</button></div>
                            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                                <table class="w-full text-left"><thead class="bg-slate-50 text-slate-500 text-xs uppercase font-semibold"><tr><th class="px-6 py-4">ID</th><th class="px-6 py-4">Client</th><th class="px-6 py-4">Date</th><th class="px-6 py-4">Amount</th><th class="px-6 py-4">Status</th><th class="px-6 py-4">Action</th></tr></thead>
                                <tbody class="divide-y divide-slate-100 text-sm">${db.invoices.map(inv => `<tr class="hover:bg-slate-50"><td class="px-6 py-4 font-mono text-slate-500">${inv.id}</td><td class="px-6 py-4 font-medium">${getClient(inv.clientId) ? getClient(inv.clientId).name : 'Unknown'}</td><td class="px-6 py-4 text-slate-500">${inv.date}</td><td class="px-6 py-4 font-bold">${inv.amount}</td><td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs font-bold ${inv.status === 'Paid' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}">${inv.status}</span></td><td class="px-6 py-4"><button onclick="showToast('Downloading PDF...', 'info')" class="text-brand-600 hover:underline text-xs">PDF</button></td></tr>`).join('')}</tbody></table>
                            </div>
                        </div>
                    `;
                } else if (view === 'admin-logs') {
                    title.innerText = 'Audit Logs';
                    container.innerHTML = `
                        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden fade-in">
                            <div class="p-4 border-b border-slate-100"><input type="text" onkeyup="filterLogs(this.value)" placeholder="Filter logs..." class="w-full pl-4 pr-4 py-2 bg-slate-50 border rounded-lg focus:ring-2 focus:ring-brand-500 outline-none"></div>
                            <div class="max-h-[600px] overflow-y-auto">
                                <table class="w-full text-left border-collapse"><thead class="bg-slate-50 text-slate-500 text-xs uppercase font-semibold sticky top-0 z-10"><tr><th class="px-6 py-4">Time</th><th class="px-6 py-4">User</th><th class="px-6 py-4">Action</th><th class="px-6 py-4">Details</th></tr></thead>
                                <tbody class="divide-y divide-slate-100 text-sm" id="logs-table-body">${db.logs.map(log => `<tr class="hover:bg-slate-50"><td class="px-6 py-3 text-slate-400 whitespace-nowrap">${log.date}</td><td class="px-6 py-3 font-medium text-slate-800">${log.user}</td><td class="px-6 py-3"><span class="px-2 py-1 bg-slate-100 rounded text-xs font-bold text-slate-600">${log.action}</span></td><td class="px-6 py-3 text-slate-500">${log.details}</td></tr>`).join('')}</tbody></table>
                            </div>
                        </div>
                    `;
                }
            }, 250); 
        }

        // --- ACTIONS & LOGIC ---
        let selectedService = null;
        function selectService(id, cost, name) {
            selectedService = { id, cost, name };
            document.querySelectorAll('.service-card').forEach(el => el.classList.remove('border-brand-500', 'bg-blue-50'));
            document.getElementById(`srv-${id}`).classList.add('border-brand-500', 'bg-blue-50');
            document.getElementById('cost-display').innerText = `${cost} Credits`;
            const remaining = currentUser.credits - cost;
            const elRem = document.getElementById('remaining-display');
            elRem.innerText = `${remaining} Credits`;
            const btn = document.getElementById('btn-submit-req');
            if (remaining < 0) {
                elRem.classList.add('text-red-600'); elRem.classList.remove('text-brand-600');
                btn.disabled = true; btn.innerText = "Insufficient Credits";
            } else {
                elRem.classList.remove('text-red-600'); elRem.classList.add('text-brand-600');
                btn.disabled = false; btn.innerText = "Submit Request";
            }
        }

        function submitRequest() {
            if (!selectedService) return;
            const notes = document.getElementById('req-notes').value;
            const newReq = { id: generateId(), clientId: currentUser.id, service: selectedService.name, cost: selectedService.cost, status: 'Pending', date: fmtDate(new Date()), notes: notes, assignee: '', eta: 'TBD', files: [], messages: [] };
            db.requests.unshift(newReq);
            showToast('Request submitted successfully!', 'success');
            router('client-home');
        }

        function sendChat(e, reqId) {
            e.preventDefault();
            const input = document.getElementById(`chat-input-${reqId}`);
            const text = input.value.trim();
            if(!text) return;
            
            const req = db.requests.find(r => r.id === reqId);
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Add Message
            req.messages.push({ sender: currentUser.name, text: text, time: time });
            
            // Update UI
            const chatBox = document.getElementById(`chat-box-${reqId}`);
            const bubble = document.createElement('div');
            bubble.className = 'chat-bubble chat-mine fade-in';
            bubble.innerHTML = `<div class="text-xs opacity-75 mb-1 flex justify-between gap-4"><span>${currentUser.name}</span> <span>${time}</span></div>${text}`;
            chatBox.appendChild(bubble);
            chatBox.scrollTop = chatBox.scrollHeight;
            input.value = '';

            // Simulate Reply
            if(currentRole === 'Client') {
                setTimeout(() => {
                    const reply = "Received. I'll look into this shortly.";
                    req.messages.push({ sender: 'System', text: reply, time: time });
                    if(document.getElementById(`chat-box-${reqId}`)) {
                         const replyBubble = document.createElement('div');
                         replyBubble.className = 'chat-bubble chat-other fade-in';
                         replyBubble.innerHTML = `<div class="text-xs opacity-75 mb-1 flex justify-between gap-4"><span>System</span> <span>${time}</span></div>${reply}`;
                         chatBox.appendChild(replyBubble);
                         chatBox.scrollTop = chatBox.scrollHeight;
                    }
                }, 1000);
            }
        }

        function updateAssignee(reqId, name) {
            const req = db.requests.find(r => r.id === reqId);
            req.assignee = name;
            db.logs.unshift({ id: Date.now(), date: fmtDate(new Date()), user: 'Admin', action: 'Assignee Update', details: `Assigned ${reqId} to ${name}` });
            showToast(`Assigned to ${name}`, 'success');
        }

        function fakeUpload(reqId) {
            const req = db.requests.find(r => r.id === reqId);
            const name = prompt("Enter fake filename (e.g. brief.pdf):", "Asset.png");
            if(name) {
                req.files.push(name);
                const list = document.getElementById(`file-list-${reqId}`);
                list.innerHTML += `<div class="flex items-center gap-2 text-sm text-slate-600 bg-slate-50 p-2 rounded border border-slate-100"><i class="fa-solid fa-file text-slate-400"></i> ${name}<i class="fa-solid fa-download ml-auto text-slate-400 cursor-pointer hover:text-brand-600"></i></div>`;
                showToast('File uploaded', 'success');
            }
        }

        function buyPackage(pkgId) {
            const pkg = PACKAGES.find(p => p.id === pkgId);
            showToast(`Processing payment for ${pkg.name}...`, 'info');
            setTimeout(() => {
                currentUser.credits += pkg.credits;
                getClient(currentUser.id).credits += pkg.credits;
                db.logs.unshift({ id: Date.now(), date: fmtDate(new Date()), user: currentUser.name, action: 'Purchase', details: `Bought ${pkg.name} (+${pkg.credits} Cr)` });
                showToast('Payment Successful!', 'success');
                router('client-home');
            }, 1500);
        }

        function processRequest(reqId, action) {
            const req = db.requests.find(r => r.id === reqId);
            const client = getClient(req.clientId);
            if (action === 'approve') {
                if (client.credits < req.cost) { showToast('Insufficient credits', 'error'); return; }
                client.credits -= req.cost; client.spent += req.cost; req.status = 'Approved';
                db.logs.unshift({ id: Date.now(), date: fmtDate(new Date()), user: 'Admin', action: 'Approval', details: `Approved ${req.id}` });
                showToast('Approved', 'success');
            } else {
                req.status = 'Rejected'; showToast('Rejected', 'info');
            }
            router('admin-requests');
        }

        function openAddClientModal() {
            document.getElementById('modal-content').innerHTML = `<div class="p-6"><h3 class="text-lg font-bold mb-4">Add Client</h3><form onsubmit="saveNewClient(event)" class="space-y-4"><input id="new-client-name" class="w-full border border-slate-300 rounded p-2" placeholder="Name"><input id="new-client-email" class="w-full border border-slate-300 rounded p-2" placeholder="Email"><input type="number" id="new-client-credits" class="w-full border border-slate-300 rounded p-2" placeholder="Initial Credits"><div class="flex justify-end gap-2"><button type="button" onclick="closeModal()" class="px-4 py-2">Cancel</button><button type="submit" class="bg-brand-600 text-white px-4 py-2 rounded">Save</button></div></form></div>`;
            document.getElementById('modal-overlay').classList.remove('hidden', 'opacity-0');
        }
        function saveNewClient(e) {
            e.preventDefault();
            db.clients.push({ id: Date.now().toString(), name: document.getElementById('new-client-name').value, email: document.getElementById('new-client-email').value, credits: parseInt(document.getElementById('new-client-credits').value)||0, status: 'Active', joined: fmtDate(new Date()), spent: 0 });
            closeModal(); router('admin-clients'); showToast('Client Added', 'success');
        }
        function openAddCreditModal(cId) {
            const c = getClient(cId);
            document.getElementById('modal-content').innerHTML = `<div class="p-6"><h3 class="text-lg font-bold mb-4">Credits: ${c.name}</h3><p class="mb-4">Current: ${c.credits}</p><input type="number" id="modal-amount" class="w-full border border-slate-300 rounded p-2 mb-4" placeholder="Amount to add/remove"><div class="flex justify-end gap-2"><button onclick="closeModal()" class="px-4 py-2">Cancel</button><button onclick="confirmAddCredits('${cId}')" class="bg-brand-600 text-white px-4 py-2 rounded">Update</button></div></div>`;
            document.getElementById('modal-overlay').classList.remove('hidden', 'opacity-0');
        }
        function confirmAddCredits(cId) {
            const amt = parseInt(document.getElementById('modal-amount').value);
            getClient(cId).credits += amt;
            closeModal(); router('admin-clients'); showToast('Balance Updated', 'success');
        }
        function closeModal() { document.getElementById('modal-overlay').classList.add('hidden', 'opacity-0'); }
        function showToast(msg, type = 'info') {
            const el = document.createElement('div');
            el.className = `${type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-slate-800'} text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 min-w-[300px] transform translate-x-full transition-all duration-300`;
            el.innerHTML = `<i class="fa-solid ${type === 'success' ? 'fa-check' : 'fa-info-circle'}"></i> ${msg}`;
            document.getElementById('toast-container').appendChild(el);
            requestAnimationFrame(() => el.classList.remove('translate-x-full'));
            setTimeout(() => el.remove(), 3000);
        }
    </script>
</body>
</html>
